<!-- Standard Delete Confirmation Modal Component -->
{% macro delete_confirmation_modal(modal_id, entity_name, entity_type="", warning_message="", deletion_endpoint="", icon_class="mdi-delete", confirm_button_id="", entity_name_span_id="", additional_warnings="") %}
{% set confirm_button_id = confirm_button_id or ("confirmDelete" + entity_name.replace(' ', '')) %}
{% set entity_name_span_id = entity_name_span_id or ("delete" + entity_name.replace(' ', '') + "Name") %}

<div class="modal fade" id="{{ modal_id }}" tabindex="-1" role="dialog" aria-labelledby="{{ modal_id }}Label" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="{{ modal_id }}Label">
          <i class="mdi {{ icon_class }} mr-2"></i>
          Confirm Deletion
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning">
          <i class="mdi mdi-alert mr-2"></i>
          Are you sure you want to delete the {{ entity_type or entity_name.lower() }} "<span id="{{ entity_name_span_id }}"></span>"?
        </div>
        {% if warning_message %}
        <p class="text-muted">{{ warning_message }}</p>
        {% else %}
        <p class="text-muted">This action cannot be undone.</p>
        {% endif %}
        {% if additional_warnings %}
        <div class="alert alert-info">
          <i class="mdi mdi-information mr-2"></i>
          {{ additional_warnings }}
        </div>
        {% endif %}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
          <i class="mdi mdi-close mr-1"></i>
          Cancel
        </button>
        <button type="button" class="btn btn-danger" id="{{ confirm_button_id }}">
          <i class="mdi mdi-delete mr-1"></i>
          Delete {{ entity_name }}
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// Standard delete confirmation function for {{ entity_name }}
let current{{ entity_name.replace(' ', '') }}DeleteId = null;

// Show delete modal
function show{{ entity_name.replace(' ', '') }}DeleteModal(id, name) {
    current{{ entity_name.replace(' ', '') }}DeleteId = id;
    $('#{{ entity_name_span_id }}').text(name);
    $('#{{ modal_id }}').modal('show');
}

// Confirm deletion
$('#{{ confirm_button_id }}').on('click', function() {
    if (!current{{ entity_name.replace(' ', '') }}DeleteId) return;

    $.ajax({
        url: `{{ deletion_endpoint }}/${current{{ entity_name.replace(' ', '') }}DeleteId}`,
        method: 'DELETE',
        success: function(response) {
            $('#{{ modal_id }}').modal('hide');
            current{{ entity_name.replace(' ', '') }}DeleteId = null;
            
            // Show success message
            const alert = `
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <i class="mdi mdi-check mr-2"></i>
                    {{ entity_name }} has been deleted successfully.
                    <button type="button" class="close" data-dismiss="alert">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            `;
            $('.content-header .container-fluid').after(alert);
            setTimeout(() => $('.alert').fadeOut(), 5000);
            
            // Reload table if it exists
            if (typeof {{ entity_name.lower().replace(' ', '') }}sTable !== 'undefined') {
                {{ entity_name.lower().replace(' ', '') }}sTable.ajax.reload();
            } else if (typeof table !== 'undefined') {
                table.ajax.reload();
            } else {
                // Fallback to page reload
                setTimeout(() => window.location.reload(), 1000);
            }
        },
        error: function(xhr) {
            const error = xhr.responseJSON?.detail || 'Failed to delete {{ entity_name.lower() }}';
            alert('Error: ' + error);
            $('#{{ modal_id }}').modal('hide');
            current{{ entity_name.replace(' ', '') }}DeleteId = null;
        }
    });
});
</script>
{% endmacro %}